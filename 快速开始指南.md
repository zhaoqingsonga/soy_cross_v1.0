
# 🌱 大豆杂交组合系统：快速开始指南

作者  赵青松
2025年8月25日

## 一、环境准备

请先加载必要的 R 包和主函数：

```r
library(openxlsx)
source("R/mainfunction.R")
library(dplyr)
library(stringr)
```

---

## 二、亲本数据初始化

### 1. 读取原始亲本数据

```r
parent <- read.xlsx("data/亲本test.xlsx", "杂交")
print(parent)
```

### 2. 初始化亲本表（生成 `parent_table.rds`）

```r
initialize_parent_table(parent)
```

### 3. 查看当前亲本表

```r
readRDS("data/parent_table.rds")
```

---

## 三、杂交组合初始化

### 1. 生成组合表（`cross_table.rds`）

```r
combi <- combine_records()
```

### 2. 查看组合表

```r
readRDS("data/cross_table.rds")
```

---

## 四、亲本增删与组合更新

### 1. 增加新亲本并自动更新组合表

```r
add_parent_and_append_cross(data.frame(名称 = c("test1", "test2")))
```

### 2. 删除最后添加的亲本及其组合（仅支持回退）

```r
remove_last_parents(2)
```

---

## 五、亲本信息编辑（通过 Excel）

### 1. 导出 Excel 编辑模板（**不可增加或删除记录**）

```r
edit_parent_table_via_excel("export")
```

编辑完成后，保存文件再导入：

### 2. 导入编辑后的亲本数据

```r
edit_parent_table_via_excel("import")
```

---

## 六、杂交组合设计

### 1. 自定义配制组合（设置母本、父本、组合内容）

```r
mycross <- run_cross_plan(
  n = 3,
  mother_names = c("郑1307", "中黄301", "中黄13"),
  father_names = c("中黄13", "齐黄34", "金豆99"),
  content_value = "2025_test01"
)
```

### 2. 更多组合样例

```r
mycross <- run_cross_plan(
  n = 1,
  mother_names = c("郑1307", "中黄301", "中黄13", "平豆2号"),
  father_names = c("中黄13", "齐黄34", "金豆99", "平豆2号"),
  content_value = "A"
)
```

---

## 七、杂交组合批次管理

### 1. 查看所有批次

```r
summarize_cross_batches()
```

### 2. 按批次筛选组合

```r
filter_cross_by_batches(c("2025_test01"))
```

### 3. 删除指定批次组合

```r
clear_cross_batches(c("2025_test01"))
```

---

## 八、杂交组合矩阵与反交

### 1. 导出组合矩阵（含正交与反交）

```r
export_cross_matrix()
```

### 2. 查看矩阵内容

```r
readRDS("data/cross_matrix.rds")
read.xlsx("data/cross_matrix_reverse.xlsx")
```

---

## 九、亲本使用统计

### 查看亲本在母本与父本方向的使用情况：

```r
merge_mother_father_stats()
```

---

📁 所有数据文件默认位于 `data/` 目录
📌 注意：编辑亲本 Excel 时请勿增加或删除记录行

---